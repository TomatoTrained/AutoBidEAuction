<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Notifications Page</title>
    <style>
        .notification:last-child {
            border-bottom: none;
        }
        .notification {
            padding: 10px;
            border-bottom: 1px solid #ccc;  /* Fixed typo on border */
        }
        h1 {
            color: green;
            font-family: Arial, sans-serif;
        }
        body {
            background-color: white;
        }
    </style>
</head>
<body>
    <h1>Notifications</h1>
    <div id="notifications-container"></div>
    <div id="highest-bidder-amount"></div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-messaging.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBXE5Cp4foZxRPcAOlCSHfbKTFwIWdQSWE",
            authDomain: "user-login-form-a440d.firebaseapp.com",
            databaseURL: "https://user-login-form-a440d-default-rtdb.firebaseio.com",
            projectId: "user-login-form-a440d",
            storageBucket: "user-login-form-a440d.appspot.com",
            messagingSenderId: "536643428878",
            appId: "1:536643428878:web:b9527baf1828015b0a525f",
            measurementId: "G-8DP3R6WJYB"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const messaging = firebase.messaging();

        // Request permission for notifications
        Notification.requestPermission().then((permission) => {
            if (permission === 'granted') {
                console.log('Notification permission granted.');
                getToken();
            } else {
                console.log('Unable to get permission to notify.');
            }
        });

        function getToken() {
            messaging.getToken({ vapidKey: 'YOUR_VAPID_PUBLIC_KEY' }).then((currentToken) => {
                if (currentToken) {
                    console.log('FCM Token:', currentToken);
                    // Send this token to your server to send notifications
                } else {
                    console.log('No registration token available. Request permission to generate one.');
                }
            }).catch((err) => {
                console.log('An error occurred while retrieving token. ', err);
            });
        }

        // Handle incoming messages
        messaging.onMessage((payload) => {
            console.log('Message received. ', payload);
            // Display notification
            displayNotification(payload.notification);
        });

        function displayNotification(notification) {
            const container = document.getElementById("notifications-container");
            const notificationElement = document.createElement("div");
            notificationElement.textContent = notification.body; // Display the notification body
            notificationElement.classList.add("notification");  // Added class for styling
            container.appendChild(notificationElement);
        }

        // Get the highest bidder amount from Firebase
        const highestBidderAmountElement = document.getElementById('highest-bidder-amount');

        // Listen for changes to the bids nodes
        database.ref('bids').on('value', (snapshot) => {
            const bids = snapshot.val();
            if (bids && Object.keys(bids).length > 0) {
                const highestBidderAmount = Math.max(...Object.values(bids));
                highestBidderAmountElement.innerText = `Highest Bidder Amount: $${highestBidderAmount}`;
            } else {
                highestBidderAmountElement.innerText = "No bids available.";
            }
        });

        // Initial call to get notifications (if needed)
        // This can be removed if you're only relying on FCM for notifications
        // getNotifications();
    </script>
</body>
</html>
