<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8" />  
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />  
    <title>Admin - Upload Car</title>  
    <link rel="stylesheet" href="stylz3.css" />  
</head>  
<body>  
    <h1>Upload a Car</h1>  
    <form id="carForm">  
        <input type="text" id="make" placeholder="Car Make" required />  
        <input type="text" id="model" placeholder="Car Model" required />  
        <input type="number" id="year" placeholder="Year" required />  
        <input type="number" id="price" placeholder="Price" required />  
        <input type="file" id="image" accept="image/*" required />  
        <button type="submit">Upload Car</button>  
    </form>  

    <script type="module">  
        // Import the Firebase modules  
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-app.js";  
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-firestore.js";  
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-storage.js";  

        // Your Firebase configuration  
        const firebaseConfig = {  
            apiKey: "AIzaSyBXE5Cp4foZxRPcAOlCSHfbKTFwIWdQSWE",  
            authDomain: "user-login-form-a440d.firebaseapp.com",  
            databaseURL: "https://user-login-form-a440d-default-rtdb.firebaseio.com",  
            projectId: "user-login-form-a440d",  
            storageBucket: "user-login-form-a440d.appspot.com",  
            messagingSenderId: "536643428878",  
            appId: "1:536643428878:web:b9527baf1828015b0a525f"  
        };  

        // Initialize Firebase  
        const app = initializeApp(firebaseConfig);  
        const db = getFirestore(app);  
        const storage = getStorage(app);  

        document.getElementById('carForm').addEventListener('submit', async (e) => {  
            e.preventDefault();  

            const make = document.getElementById('make').value;  
            const model = document.getElementById('model').value;  
            const year = document.getElementById('year').value;  
            const price = document.getElementById('price').value;  
            const imageFile = document.getElementById('image').files[0];  

            // Check if an image file is selected  
            if (!imageFile) {  
                alert("Please select an image file.");  
                return;  
            }  

            try {  
                // Upload image to Firebase Storage  
                const storageRef = ref(storage, `car-images/${imageFile.name}`);  
                await uploadBytes(storageRef, imageFile);  // Using uploadBytes  
                const imageUrl = await getDownloadURL(storageRef);  

                // Save car information in Firestore  
                await addDoc(collection(db, 'cars'), {  
                    make,  
                    model,  
                    year: parseInt(year),  
                    price: parseFloat(price),  
                    imageUrl,  
                    bids: []  
                });  
                
                alert('Car uploaded successfully!');  
                document.getElementById('carForm').reset();  // Reset form fields  

            } catch (error) {  
                console.error("Error uploading car:", error);  
                alert('Failed to upload car. Please try again.');  
            }  
        });  
    </script>  
</body>  
</html>
